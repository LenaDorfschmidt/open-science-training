<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>data_and_file_management.utf8</title>

<script src="site_libs/header-attrs-2.5/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Reproducible Research (in R)</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="open-science.html">Open Science</a>
</li>
<li>
  <a href="data_and_file_management.html">Data and File Management</a>
</li>
<li>
  <a href="rmarkdown.html">R Markdown</a>
</li>
<li>
  <a href="git.html">Version Control</a>
</li>
<li>
  <a href="further_ideas.html">Further Ideas</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<p><br /> <br /></p>
<p align="center">
<iframe src="https://docs.google.com/presentation/d/e/2PACX-1vRywsJNcOVxdy6FKxwIu7iG9C9Ts1suT2uTqw8MyBFCHiv8mGZOvIDhx0PIAsii6F5MkWtgYopKbnnc/embed?start=false&amp;loop=false&amp;delayms=3000" frameborder="0" width="672" height="398" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true">
</iframe>
</p>
<p><br /><br /></p>
<div class="summarybox">
<div class="summarybox-title">
<p><font size="5"> <i class="fas fa-question-circle"></i> <strong>Overview</strong> </font></p>
</div>
<ol style="list-style-type: decimal">
<li>You will learn how to set up a file organization that allows for users (including your future self) to easily understand the structure of your project.</li>
<li>You will learn how to name your files to support easy access to your project.</li>
</ol>
</div>
<p><br /><br /></p>
<div id="data-manipulation" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Data Manipulation</h1>
<p>It is rarely ever the case that one receives a data set that is read to use for one’s purposes. Here, we will practice a few tricks in R to clean up a data set. Different data sets come with different issues of course, but hopefully this tutorial will:</p>
<ol style="list-style-type: decimal">
<li>get you used to the idea of cleaning your data using scripts.</li>
<li>show potential issues of reading in excel files.</li>
<li>provide examples of how to fix column names.</li>
<li>get you thinking of issues with data cleaning.</li>
</ol>
<p>In particular, we will use the <code>readxl</code> and <code>tidyverse</code> packages. The first is a great resource to read in <code>.xlsx</code> files, while the latter helps us clean data, in particular by providing tools to clean up column names. The third package we are loading in here is <code>here</code> - ignore this for now, we will revisit it in the session on R Markdown.</p>
<p>Go ahead and download the dataset associated with the <a href="https://doi.org/10.1038/533452a">Baker (2016)</a> paper ‘1,500 scientists lift the lid on reproducibility’. Place the data in a folder called <code>data</code>. Now create an R scripts to start cleaning your data.</p>
<p>Start by loading in the following packages:</p>
<pre class="r"><code>library(readxl)
library(tidyverse)
library(here) </code></pre>
<p>The first thing we will have noticed upon downloading the data is the spaces in the file name which should make the hair stand up on the back of your neck! We’ll deal with that in a moment!</p>
<p><br/></p>
</div>
<div id="loading-in-data" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Loading in data</h1>
<p>First of all, let’s read in the data and inspect it a little:</p>
<pre class="r"><code>data_dirty &lt;- read_excel(here(&quot;data/Reproducibility Survey Raw Data.xlsx&quot;))</code></pre>
<pre><code>## Warning in read_fun(path = enc2native(normalizePath(path)), sheet_i = sheet, :
## Expecting logical in CZ1141 / R1141C104: got &#39;any&#39;</code></pre>
<p>If you run <code>View(data_dirty)</code> a few things you may notice:</p>
<ul>
<li>This file has two rows which specify column names. For example the question ‘Have you published a manuscript in the past 3 years?’ is in in the column name, but then row one of our data contains the options ‘Yes, in an NPG journal’, ‘Yes, in a non-NPG journal’ and ‘No’.</li>
<li>There are spaces in the column names. Grrr…</li>
<li>The column names are case sensitive.</li>
</ul>
<p>None of those makes us happy. Remember that you can access column names using:</p>
<pre class="r"><code>colnames(data_dirty)</code></pre>
<p><br/></p>
</div>
<div id="merge-columnnames" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Merge columnnames</h1>
<p>Now you will have noticed the column names are split across two rows.</p>
<p>Excel files often have weird formatting issues, column names being split across rows being only one of them. Other issues you may encounter with excel files is that people may have used the first few rows of the file to provide information on their data. You can deal with that by <em>not</em> reading in the first <code>N</code> rows of a file, using <code>read_excel(..., skip=N)</code>. Fortunately, we don’t need that here, so back to topic:</p>
<p>Let’s find the column for which important information is included int he second row:</p>
<pre class="r"><code>replace_idx = which(!is.na(data_dirty[1,]))</code></pre>
<p>We can now use this index to copy over the information from the second row to the column names.</p>
<pre class="r"><code>colnames(data_dirty)[replace_idx] &lt;- data_dirty[1,replace_idx]
data_clean &lt;- data_dirty[-1,]</code></pre>
<p>One thing I’d always suggest when you have several columns that are related to each other in some way is to have a common column identifier. This makes data reformatting much easier! Here, we will add the prefix <code>published manuscript</code> to all columns relating to ‘Have you published a manuscript in the past 3 years?’.</p>
<pre class="r"><code>colnames(data_clean)[c(7,8,9)] &lt;- paste0(&#39;published_manuscript-&#39;,colnames(data_clean)[c(7,8,9)])</code></pre>
<p>You could go ahead and add other prefixed to the other columns we just edited.</p>
<p><br/></p>
</div>
<div id="tidy-up-column-names" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Tidy up column names</h1>
<p>Another common task in cleaning your data may be to tidy up column names. In this case, we may want to replace all spaces in column names by underscores and make the column names all lower case. With different data, you may come across different problems, but hopefully this helps you get an idea of how to approach the problem of renaming column names.</p>
<p>We will get rid of the spaces in the column names and make the column names all lower case.</p>
<p>We will use the <code>%&gt;%</code> operator from <code>dplyr</code>, which conveniently is included in <code>tidverse</code>. If you haven’t used this operator before, have a look at <a href="https://www.datacamp.com/community/tutorials/pipe-r-tutorial">these resources</a>.</p>
<pre class="r"><code>colnames(data_clean) &lt;- colnames(data_clean) %&gt;% 
  str_replace_all(&quot;\\s&quot;, &quot;_&quot;) %&gt;% # remove spaces
  str_replace_all(&quot;\&quot;&quot;, &quot;&quot;) %&gt;% # remove backslashed
  str_replace_all(&quot;,&quot;, &quot;&quot;) %&gt;% # remove commas
  tolower() # all lower case</code></pre>
<p>The <code>stringr</code> package included in <code>tidyverse</code> is a great tool to reformat your column names (and any other strings). To apply it more generally to your data, check out their <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf">cheatsheet</a>.</p>
<p><br/></p>
</div>
<div id="remove-empty-lines" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Remove empty lines</h1>
<p>Lastly, as a quick check, let’s make sure we don’t have any empty rows in our data. I am just quickly plotting the number of <code>NA</code> per row.</p>
<pre class="r"><code>hist(rowSums(is.na(data_clean)), main=&#39;Number of NAs per Row&#39;,xlab=&#39;N NA per Row&#39;)</code></pre>
<p><img src="data_and_file_management_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>If you have a look at the questions, some are not meant to be answered by all participants, so the fact that we see a number of outliers per subject here isn’t super concerning. All I wanted to know here is that we don’t have data entry problems where complete rows are empty. Looks like we are all good!</p>
<p><br/></p>
</div>
<div id="save-data" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Save data</h1>
<p>Lastly, let’s save a clean version of our data. This will be the version we could work on from now on. As a rule, <strong>never</strong> make changes/overwrite your raw data. Always save the cleaned version as a new file.</p>
<pre class="r"><code>write.csv(data_clean, file=here(&#39;data/data_clean.csv&#39;), row.names = F)</code></pre>
<div class="taskbox">
<div class="taskbox-title">
<p><font size="5"> <i class="fas fa-exclamation-circle"></i> <strong>Summary</strong> </font></p>
</div>
<ol style="list-style-type: decimal">
<li>Choose a file naming system and organization - any system - to make your project more accessible.</li>
<li>Setting up a system may take some effort, but future users (including your future self) will thank you for it.</li>
</ol>
</div>
<p><br /><br /></p>
</div>
<div id="further-resources" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Further Resources</h1>
<p>Learn what copyright permissions you can use to publish your data, code and tools by having a look at <a href="https://creativecommons.org/licenses/">creative commons licenses</a>.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5,h6",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
